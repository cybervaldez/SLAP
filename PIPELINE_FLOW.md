# SLAP! — Pipeline Flow

The complete skill invocation sequence for building a design project from blank canvas to fully reviewed, iterated design.

---

## Overview

Two workflows exist depending on your starting point:

### Quick Path: You Already Have HTML

```
/slap mydesign.html          → Onboard + generate reviews
/slap-guard                   → Validate + generate tests
Review in UI                  → Select feedback, copy prompt
/slap improved.html --parent v1  → Next iteration
```

### Full Path: From Scratch

```
Phase A: SHAPE (Design Direction)
  A1. /team         → Strategic advice on direction
  A2. /ux-planner   → Interaction flows + section map
  A3. /ui-planner   → Visual design with previews
  A4. /ui-review    → Slop guard before implementation

Phase B: BUILD (Implementation)
  B1. /create-task   → Implement with data-section attributes

Phase C: REVIEW (Generate Feedback)
  C1. /slap          → Onboard HTML, generate persona briefs + reviews
  C2. /slap-guard    → Validate parity, generate E2E tests

Phase D: DEEPER DIVES (Optional)
  D1. /experts       → Ad-hoc expert deep dives (reads persona briefs)
  D2. /kaizen        → Ad-hoc persona deep dives (reads persona briefs)

Phase E: ITERATE (Next Version)
  E1. Select feedback in UI → Copy prompt
  E2. Paste into Claude → /ux-planner or direct HTML generation
  E3. /slap v2.html --parent v1 → Back to Phase C
```

---

## Quick Path (Most Common)

### Step 1: `/slap` — Onboard Design

```bash
/slap projects/FlowBoard/haiku.html
```

What happens:
1. Analyzes the HTML (sections, industry, audience signals)
2. Recommends a reviewer council (all 5 experts + relevant personas)
3. **Waits for user confirmation** of the council
4. Generates per-project persona briefs at `projects/{Name}/personas/*.md`
5. Generates TypeScript review data at `src/data/{projectId}Reviews.ts`
6. Registers project in `src/data/projects.ts`
7. Copies annotated HTML to `public/projects/{Name}/{version}.html`

### Step 2: `/slap-guard` — Validate

```bash
/slap-guard flowboard haiku
```

Checks persona file coverage, section/ref parity, score sanity, traffic light distribution. Generates `tests/test_flowboard.sh`.

### Step 3: Review in UI

Open the SLAP UI at `/#/flowboard/haiku`. Click reviewer bubbles, read findings, explore sections. For deeper dives:

```bash
/experts marketing "dig deeper into the pricing section"
/kaizen frank, sarah "what do you think of the hero?"
```

These read from the persona briefs generated by `/slap`, so feedback is grounded in the specific design.

### Step 4: Iterate

Select reviewers in the UI, copy the assembled prompt, paste into Claude to generate an improved HTML. Then:

```bash
/slap projects/FlowBoard/v2.html --version v2 --parent haiku
```

This reuses existing persona briefs (same product/audience) and generates new review data.

---

## Full Path (From Scratch)

### Phase A: Shape

#### A1. `/team` — Strategic Direction

```
/team marketing, ux, design "We're building a {project description}.
Who is the target audience? What's the key value prop?
What aesthetic direction fits the brand?"
```

**Output used by:** A2 (ux-planner) for interaction decisions, A3 (ui-planner) for aesthetic direction.

#### A2. `/ux-planner` — Interaction Flows + Section Map

```
/ux-planner "Plan the interaction flow for {project/version description}.

Context from experts:
- {Key points from A1}

Define the page sections (these become data-section attributes)."
```

**Critical output:** The **Section Map** table:

| Section ID | Purpose | Key Interactions |
|------------|---------|-----------------|
| hero | First impression, value prop | Read headline, click CTA |
| features | Feature showcase | Browse cards, hover details |
| pricing | Pricing tiers | Compare tiers, click signup |
| testimonials | Social proof | Read quotes |
| cta | Final conversion | Click CTA |

#### A3. `/ui-planner` — Visual Design + Previews

```
/ui-planner "Apply visual design to the {project} interaction flow.

Section map from ux-planner:
{paste section map table}

Generate previews with all sections marked."
```

**Output:** Preview HTML files with `data-section` attributes, design tokens.

#### A4. `/ui-review` — Slop Guard

```
/ui-review {path to preview HTML}
```

- **PASS** → Proceed to Phase B
- **NEEDS ITERATION** → Fix issues, re-run

### Phase B: Build

#### B1. `/create-task` — Implementation

```
/create-task "Implement {version} of {project}.

Visual Design Spec: {from ui-planner}
Section Map: {from ux-planner}

Requirements:
- All sections: data-section="{id}" AND data-testid="{id}-section"
- Design tokens from styleguide
- Expose window.slapState"
```

### Phase C: Review

#### C1. `/slap` — Onboard + Generate Reviews

```bash
/slap path/to/design.html --project MyProject --version v1
```

This replaces the old manual Phase C workflow (manually running `/team` and `/kaizen` per reviewer, then manually wiring data). `/slap` does it all:

1. Analyzes HTML, annotates with `data-section`/`data-ref`
2. Builds reviewer council (user confirms)
3. Generates persona briefs (`projects/{Name}/personas/*.md`)
4. Generates TypeScript review data
5. Wires into `reviews.ts`

#### C2. `/slap-guard` — Validate

```bash
/slap-guard myproject v1
```

### Phase D: Deeper Dives (Optional)

After `/slap` generates initial reviews, use `/experts` or `/kaizen` for focused deep dives on specific sections or issues. These skills read the persona briefs created by `/slap` for grounded context.

```bash
/experts marketing "the pricing section scored 4/10 — what specifically needs to change?"
/kaizen elena, priya "is the feature grid accessible?"
```

### Phase E: Iterate

1. Review in SLAP UI
2. Select reviewer feedback → Copy prompt
3. Paste into Claude → new HTML
4. `/slap newversion.html --version v2 --parent v1`
5. Back to Phase C

---

## Per-Project Persona Architecture

Each project gets its own persona files — review briefs tailored to the design's specific industry, audience, and competitive landscape.

```
projects/FlowBoard/
  haiku.html                    <- source HTML
  personas/
    marketing.md                <- expert brief
    ux.md                       <- expert brief
    product.md                  <- expert brief
    technical.md                <- expert brief
    design.md                   <- expert brief
    frank.md                    <- kaizen brief
    elena.md                    <- kaizen brief
    carlos.md                   <- kaizen brief
    ...
```

### What Lives Where

| Data | Location | Purpose |
|------|----------|---------|
| Reviewer identity (name, color, icon) | `src/data/reviewers.ts` | UI rendering |
| Voice guide (tone, vocabulary) | `/experts` and `/kaizen` SKILL.md | How they speak |
| Design-specific context | `projects/{Name}/personas/*.md` | What to evaluate |
| Review data (scores, findings) | `src/data/{projectId}Reviews.ts` | Overlay display |

### Not All 23 Every Time

`/slap` recommends a reviewer panel based on the design type. Users confirm before proceeding. A PM tool might get 13 reviewers; a developer docs site might get 8.

---

## Section Map Contract

The section map flows through the entire pipeline:

```
/ux-planner → identifies sections (hero, features, pricing...)
    |
/ui-planner → maps sections to visual regions
    |
/create-task → implements data-section="" on each region
    |
/slap → annotates HTML with data-section/data-ref if missing
    |           → generates persona briefs keyed to sections
    |           → generates findings keyed to section IDs
    |
/slap-guard → validates section parity
    |
SectionHighlight → targets [data-section] for glow overlay
ReviewPanel → organizes findings by section
```

**Dual-attribute pattern on every section:**
```html
<section data-section="hero" data-testid="hero-section">
  <h1 data-ref="hero-headline" data-testid="hero-headline">...</h1>
</section>
```

- `data-section` = review system (SectionHighlight finds it)
- `data-ref` = ref highlight system (finding refs target specific elements)
- `data-testid` = e2e testing (automated tests find it)

---

## State Exposure

```typescript
window.slapState = {
  project: string,
  version: string,
  reviewMode: 'review' | 'kaizen',
  activeReviewer: string | null,
  overlayTier: 0 | 1 | 2 | 3,
  highlightedSection: string | null,
  sections: string[],
};
```

---

## Quick Reference: What Each Skill Produces

| Skill | Input | Output | Key Data |
|-------|-------|--------|----------|
| `/slap` | HTML file | Persona briefs, review data, project registration | Everything needed for the overlay |
| `/slap-guard` | Project ID | Validation report, E2E test file | Parity checks |
| `/experts` | Question + project | Expert review markdown | Grounded findings (reads persona briefs) |
| `/kaizen` | Question + project | Persona review markdown | In-character findings (reads persona briefs) |
| `/team` | Strategic question | Advice markdown | Not project-bound |
| `/ux-planner` | Requirements | Interaction flow | Section Map |
| `/ui-planner` | Section map | HTML previews | Design tokens |
| `/ui-review` | Preview HTML | Pass/fail audit | Slop detection |
| `/create-task` | Design spec | Working component | `data-section` attrs |
