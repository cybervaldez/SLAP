<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SLAP! — Landing Page v2</title>
<style>
/* ─── Reset & Base ──────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: #0D0D1A;
  color: #F5F0E1;
  font-family: 'Courier New', monospace;
  overflow-x: hidden;
}

/* ─── Design Tokens ──────────────────────────────────── */
:root {
  --bg-deep: #0D0D1A;
  --bg-dark: #1A1A2E;
  --bg-mid: #222240;
  --text-light: #F5F0E1;
  --text-muted: rgba(245, 240, 225, 0.5);
  --accent-gold: #FFD000;
  --score-green: #6BCB77;
  --score-yellow: #FFD93D;
  --score-red: #FF6B6B;
  --ease-enter: cubic-bezier(0.22, 0.61, 0.36, 1);
  --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
  --duration-micro: 100ms;
  --duration-small: 150ms;
  --duration-medium: 250ms;
  --duration-large: 400ms;
  --stagger: 60ms;
}

/* ─── Sections ───────────────────────────────────────── */
section {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 4rem 2rem;
  position: relative;
}

/* ─── HERO ───────────────────────────────────────────── */
#hero { min-height: 100vh; }

.hero-title {
  font-size: 0.9rem;
  font-weight: 700;
  letter-spacing: 0.3em;
  color: var(--text-muted);
  margin-bottom: 3rem;
  opacity: 0;
  animation: fadeIn 600ms var(--ease-enter) 300ms forwards;
}

.hands-container {
  display: flex;
  gap: 4rem;
  margin-bottom: 3rem;
  opacity: 0;
  animation: fadeIn 600ms var(--ease-enter) 600ms forwards;
}

.hand {
  font-size: 4rem;
  cursor: pointer;
  transition: transform var(--duration-small) var(--ease-bounce),
              filter var(--duration-small);
  filter: drop-shadow(0 0 0px transparent);
  user-select: none;
}
.hand:hover {
  transform: scale(1.15) rotate(-8deg);
  filter: drop-shadow(0 0 20px var(--accent-gold));
}

/* Screen shake */
@keyframes screenShake {
  0%   { transform: translateX(0); }
  15%  { transform: translateX(-3px); }
  30%  { transform: translateX(3px); }
  45%  { transform: translateX(-3px); }
  60%  { transform: translateX(3px); }
  75%  { transform: translateX(-2px); }
  90%  { transform: translateX(2px); }
  100% { transform: translateX(0); }
}
body.shaking {
  animation: screenShake 150ms linear;
}

/* SLAP! flash */
.slap-flash {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--accent-gold);
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 80ms linear;
}
.slap-flash.active {
  opacity: 1;
}
.slap-flash h1 {
  font-size: 6rem;
  font-weight: 900;
  letter-spacing: 0.2em;
  color: var(--bg-deep);
}

/* Hero whisper — replaces old subtitle */
.hero-whisper {
  font-size: 0.5rem;
  font-weight: 400;
  letter-spacing: 0.08em;
  color: var(--text-muted);
  opacity: 0;
  transition: opacity 600ms var(--ease-enter);
  margin-top: -1rem;
  margin-bottom: 2rem;
}
.hero-whisper.visible { opacity: 1; }

.scroll-indicator {
  position: absolute;
  bottom: 2rem;
  font-size: 0.5rem;
  color: var(--text-muted);
  letter-spacing: 0.1em;
  opacity: 0;
  transition: opacity 600ms var(--ease-enter);
  animation: float 2s ease-in-out infinite;
}
.scroll-indicator.visible { opacity: 1; }

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(6px); }
}

/* ─── PROBLEM ────────────────────────────────────────── */
#problem { background: var(--bg-dark); min-height: 80vh; }

.problem-title {
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.2em;
  color: var(--text-muted);
  margin-bottom: 3rem;
}

.slop-grid {
  display: flex;
  gap: 1.5rem;
  flex-wrap: wrap;
  justify-content: center;
}

.slop-card {
  width: 200px;
  height: 260px;
  border-radius: 6px;
  overflow: hidden;
  position: relative;
  opacity: 0;
  transform: translateY(20px);
  transition: all 500ms var(--ease-enter);
}
.slop-card.visible {
  opacity: 1;
  transform: translateY(0);
}

/* 3D flip container for card #3 */
.slop-card.flip-card {
  perspective: 800px;
  overflow: visible;
  background: none;
}
.flip-card-inner {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 400ms var(--ease-enter);
}
.flip-card.flipped .flip-card-inner {
  transform: rotateY(180deg);
}
.flip-card-front,
.flip-card-back {
  position: absolute;
  inset: 0;
  backface-visibility: hidden;
  border-radius: 6px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
.flip-card-back {
  transform: rotateY(180deg);
}

.slop-card-inner {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* SLOP designs — slate gradient (replaces off-brand purple) */
.slop-design {
  flex: 1;
  background: linear-gradient(135deg, #94A3B8, #64748B);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  gap: 0.5rem;
}

/* Card 1: Landing Page archetype */
.slop-design.archetype-landing {
  gap: 0.4rem;
}
.slop-design.archetype-landing .fake-hero-banner {
  width: 85%;
  height: 40px;
  background: rgba(255,255,255,0.2);
  border-radius: 4px;
  margin-bottom: 0.3rem;
}
.slop-design.archetype-landing .fake-headline {
  width: 60%;
  height: 10px;
  background: rgba(255,255,255,0.3);
  border-radius: 4px;
}
.slop-design.archetype-landing .fake-text {
  width: 45%;
  height: 6px;
  background: rgba(255,255,255,0.2);
  border-radius: 3px;
}
.slop-design.archetype-landing .fake-btn-pill {
  width: 35%;
  height: 16px;
  background: rgba(255,255,255,0.25);
  border-radius: 999px;
  margin-top: 0.4rem;
}

/* Card 2: Dashboard archetype */
.slop-design.archetype-dashboard {
  gap: 0.35rem;
  padding: 0.75rem;
}
.slop-design.archetype-dashboard .fake-metrics {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.3rem;
  width: 100%;
}
.slop-design.archetype-dashboard .fake-metric {
  height: 32px;
  background: rgba(255,255,255,0.18);
  border-radius: 3px;
}
.slop-design.archetype-dashboard .fake-chart {
  width: 100%;
  height: 50px;
  background: rgba(255,255,255,0.12);
  border-radius: 3px;
  margin-top: 0.3rem;
  position: relative;
  overflow: hidden;
}
.slop-design.archetype-dashboard .fake-chart::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 5%;
  right: 5%;
  height: 60%;
  background: linear-gradient(to right,
    rgba(255,255,255,0.08) 0%,
    rgba(255,255,255,0.2) 30%,
    rgba(255,255,255,0.12) 60%,
    rgba(255,255,255,0.25) 100%
  );
  clip-path: polygon(0% 80%, 25% 40%, 50% 60%, 75% 20%, 100% 50%, 100% 100%, 0% 100%);
}

/* Card 3: Card Gallery archetype */
.slop-design.archetype-gallery {
  gap: 0.35rem;
  padding: 0.75rem;
}
.slop-design.archetype-gallery .fake-card-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 0.3rem;
  width: 100%;
  flex: 1;
}
.slop-design.archetype-gallery .fake-gallery-card {
  display: flex;
  flex-direction: column;
  gap: 3px;
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
  padding: 4px;
}
.slop-design.archetype-gallery .fake-img {
  width: 100%;
  height: 28px;
  background: rgba(255,255,255,0.18);
  border-radius: 2px;
}
.slop-design.archetype-gallery .fake-card-text {
  width: 80%;
  height: 4px;
  background: rgba(255,255,255,0.2);
  border-radius: 2px;
}

/* Distinct SLAP design (for flipped card back) */
.slap-design {
  flex: 1;
  background: var(--bg-deep);
  border: 2px solid var(--accent-gold);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  gap: 0.5rem;
}
.slap-design .fake-headline {
  width: 70%;
  height: 10px;
  background: var(--accent-gold);
  border-radius: 0;
}
.slap-design .fake-text {
  width: 50%;
  height: 6px;
  background: var(--text-muted);
  border-radius: 0;
}
.slap-design .fake-bar {
  width: 60%;
  height: 3px;
  background: var(--accent-gold);
  opacity: 0.4;
}
.slap-design .fake-btn {
  width: 40%;
  height: 16px;
  background: var(--accent-gold);
  border-radius: 0;
  margin-top: 0.5rem;
}

.card-stamp {
  padding: 0.5rem 0.75rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--bg-mid);
}
.card-stamp-label {
  font-size: 0.55rem;
  font-weight: 800;
  letter-spacing: 0.15em;
}
.card-stamp-sublabel {
  font-size: 0.35rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  color: var(--text-muted);
  display: block;
  margin-top: 1px;
}
.card-stamp-score {
  font-size: 0.55rem;
  font-weight: 800;
}
.card-stamp-dots {
  display: flex;
  gap: 3px;
}
.dot { width: 6px; height: 6px; border-radius: 50%; }

/* ─── COUNCIL ────────────────────────────────────────── */
#council { background: var(--bg-deep); min-height: 100vh; padding: 3rem 2rem; }

.council-title {
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 0.2em;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.dice-btn {
  font-family: 'Courier New', monospace;
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  background: var(--bg-mid);
  color: var(--accent-gold);
  border: 2px solid var(--accent-gold);
  padding: 0.5rem 1.5rem;
  cursor: pointer;
  margin-bottom: 2rem;
  transition: all var(--duration-small) var(--ease-bounce);
}
.dice-btn:hover {
  background: var(--accent-gold);
  color: var(--bg-deep);
  transform: scale(1.05);
}
.dice-icon {
  display: inline-block;
  transition: transform 600ms var(--ease-bounce);
}
.dice-icon.rolling {
  animation: diceTumble 600ms var(--ease-bounce);
}
@keyframes diceTumble {
  0% { transform: rotate(0deg) scale(1); }
  25% { transform: rotate(90deg) scale(1.3); }
  50% { transform: rotate(180deg) scale(0.8); }
  75% { transform: rotate(270deg) scale(1.2); }
  100% { transform: rotate(360deg) scale(1); }
}

/* Expert row */
.expert-row {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
  justify-content: center;
}

/* Category rows */
.category-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}
.category-label {
  font-size: 0.4rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  color: var(--text-muted);
  text-transform: uppercase;
  width: 80px;
  text-align: right;
  flex-shrink: 0;
}

/* Reviewer bubble */
.reviewer-bubble {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all var(--duration-small) var(--ease-bounce);
  position: relative;
  flex-shrink: 0;
}
.reviewer-bubble:hover {
  transform: scale(1.12);
  border-color: var(--accent-gold);
}
.reviewer-bubble.selected {
  border-color: var(--accent-gold);
  box-shadow: 0 0 12px rgba(255, 208, 0, 0.3);
}
.reviewer-bubble.selected::after {
  content: '\2713';
  position: absolute;
  bottom: -2px;
  right: -2px;
  width: 14px;
  height: 14px;
  background: var(--accent-gold);
  color: var(--bg-deep);
  border-radius: 50%;
  font-size: 0.45rem;
  font-weight: 900;
  display: flex;
  align-items: center;
  justify-content: center;
}
.reviewer-bubble img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Tooltip on hover */
.reviewer-bubble .tooltip {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-mid);
  border: 1px solid rgba(245, 240, 225, 0.12);
  border-radius: 4px;
  padding: 6px 10px;
  white-space: nowrap;
  font-size: 0.45rem;
  color: var(--text-light);
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--duration-micro);
  z-index: 10;
  max-width: 200px;
  white-space: normal;
  text-align: center;
}
.reviewer-bubble:hover .tooltip { opacity: 1; }
.tooltip-name { font-weight: 700; letter-spacing: 0.06em; }
.tooltip-role { color: var(--text-muted); margin-top: 2px; }
.tooltip-bias { font-style: italic; color: var(--accent-gold); margin-top: 4px; font-size: 0.4rem; }

/* YOUR COUNCIL bar */
.council-bar {
  position: sticky;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--bg-dark);
  border-top: 2px solid var(--accent-gold);
  padding: 0.75rem 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  z-index: 20;
  min-height: 56px;
}
.council-bar-label {
  font-size: 0.45rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  color: var(--accent-gold);
}
.council-bar-avatars {
  display: flex;
  gap: 4px;
  flex: 1;
}
.council-bar-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  overflow: hidden;
  border: 2px solid var(--accent-gold);
  opacity: 0;
  transform: scale(0.5);
  animation: bounceIn 400ms var(--ease-bounce) forwards;
}
.council-bar-avatar img { width: 100%; height: 100%; object-fit: cover; }

@keyframes bounceIn {
  to { opacity: 1; transform: scale(1); }
}

.council-bar-actions {
  display: flex;
  gap: 0.5rem;
}
.council-bar-btn {
  font-family: 'Courier New', monospace;
  font-size: 0.5rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  padding: 0.4rem 1rem;
  border: none;
  cursor: pointer;
  transition: all var(--duration-small);
}
.btn-reroll {
  background: var(--bg-mid);
  color: var(--accent-gold);
  border: 1px solid var(--accent-gold);
}
.btn-reroll:hover { background: rgba(255, 208, 0, 0.1); }
.btn-keep {
  background: var(--accent-gold);
  color: var(--bg-deep);
}
.btn-keep:hover { filter: brightness(1.1); }

/* Live preview */
.live-preview {
  margin-top: 1.5rem;
  width: 100%;
  max-width: 500px;
  background: var(--bg-mid);
  border: 1px solid rgba(245, 240, 225, 0.12);
  border-radius: 4px;
  padding: 1rem;
  opacity: 0;
  transition: opacity 400ms var(--ease-enter);
}
.live-preview.active { opacity: 1; }

/* Finding row animation — slide in/out */
.preview-finding {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 6px 0;
  font-size: 0.55rem;
  line-height: 1.5;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  max-height: 60px;
  overflow: hidden;
  opacity: 1;
  transform: translateY(0);
  transition: all 250ms var(--ease-enter);
}
.preview-finding:last-child { border-bottom: none; }
.preview-finding.entering {
  animation: findingSlideIn 250ms var(--ease-enter) forwards;
}
.preview-finding.exiting {
  opacity: 0;
  max-height: 0;
  padding: 0;
  transform: translateY(-8px);
}
@keyframes findingSlideIn {
  from { opacity: 0; max-height: 0; transform: translateY(8px); }
  to   { opacity: 1; max-height: 60px; transform: translateY(0); }
}

.preview-light {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 3px;
}
.preview-name {
  font-weight: 700;
  letter-spacing: 0.04em;
}

/* Odometer-style score */
.preview-score-bar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.75rem;
  padding-top: 0.75rem;
  border-top: 1px solid rgba(245, 240, 225, 0.12);
}
.odometer-container {
  display: flex;
  align-items: baseline;
  overflow: hidden;
  height: 1.3rem;
}
.odometer-digit {
  display: inline-block;
  font-size: 1rem;
  font-weight: 800;
  line-height: 1.3rem;
  transition: transform 300ms var(--ease-enter), color 300ms;
  position: relative;
}
.odometer-digit.rolling {
  animation: digitRoll 300ms var(--ease-enter);
}
@keyframes digitRoll {
  0%   { transform: translateY(-100%); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}
.odometer-static {
  font-size: 1rem;
  font-weight: 800;
  line-height: 1.3rem;
}

/* Score delta badge */
.score-delta {
  font-size: 0.5rem;
  font-weight: 800;
  letter-spacing: 0.05em;
  padding: 2px 6px;
  border-radius: 3px;
  opacity: 0;
  transition: opacity 300ms var(--ease-enter);
  margin-left: 4px;
}
.score-delta.visible {
  opacity: 1;
}
.score-delta.positive {
  background: rgba(107,203,119,0.15);
  color: var(--score-green);
}
.score-delta.negative {
  background: rgba(255,107,107,0.15);
  color: var(--score-red);
}
.score-delta.fading {
  opacity: 0;
}

.preview-score-label {
  font-size: 0.45rem;
  color: var(--text-muted);
}

/* ─── GAMELOOP ───────────────────────────────────────── */
#gameloop { background: var(--bg-dark); min-height: 50vh; }

.loop-container {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}
.loop-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  opacity: 0.4;
  transition: opacity var(--duration-medium);
}
.loop-step.active { opacity: 1; }
.loop-icon {
  font-size: 2rem;
  transition: transform var(--duration-small) var(--ease-bounce);
}
.loop-step.active .loop-icon { transform: scale(1.2); }
.loop-label {
  font-size: 0.45rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  transition: color var(--duration-medium);
}
.loop-arrow {
  font-size: 0.8rem;
  color: var(--text-muted);
}
.loop-caption {
  margin-top: 2rem;
  font-size: 0.55rem;
  font-weight: 700;
  letter-spacing: 0.15em;
  color: var(--text-muted);
}

/* Gold pulse for Slap step (data-step="2") */
@keyframes pulseGold {
  0%   { box-shadow: 0 0 0 0 rgba(255, 208, 0, 0.4); }
  100% { box-shadow: 0 0 0 12px rgba(255, 208, 0, 0); }
}
.loop-step.slap-active .loop-icon {
  color: var(--accent-gold);
  animation: pulseGold 1s var(--ease-enter) infinite;
  border-radius: 50%;
}
.loop-step.slap-active .loop-label {
  color: var(--accent-gold);
}

/* ─── PIPELINE ───────────────────────────────────────── */
#pipeline { background: var(--bg-deep); }

.pipeline-title {
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.2em;
  color: var(--text-muted);
  margin-bottom: 2rem;
}

.terminal {
  width: 100%;
  max-width: 480px;
  background: var(--bg-dark);
  border: 1px solid rgba(245, 240, 225, 0.12);
  border-radius: 6px;
  overflow: hidden;
}
.terminal-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: var(--bg-mid);
  border-bottom: 1px solid rgba(245, 240, 225, 0.08);
}
.terminal-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}
.terminal-title {
  font-size: 0.45rem;
  color: var(--text-muted);
  letter-spacing: 0.08em;
  margin-left: 8px;
}
.terminal-body {
  padding: 1rem;
  font-size: 0.55rem;
  line-height: 1.8;
  min-height: 200px;
}
.terminal-line {
  opacity: 0;
  transform: translateY(4px);
  transition: all 300ms var(--ease-enter);
}
.terminal-line.visible {
  opacity: 1;
  transform: translateY(0);
}
.terminal-prompt { color: var(--score-green); }
.terminal-red { color: var(--score-red); }
.terminal-yellow { color: var(--score-yellow); }
.terminal-green { color: var(--score-green); }
.terminal-gold { color: var(--accent-gold); }

.terminal-context {
  margin-top: 0.5rem;
  padding: 0.5rem;
  border: 1px solid var(--accent-gold);
  border-radius: 2px;
}
.terminal-copied {
  display: inline-block;
  background: var(--score-green);
  color: var(--bg-deep);
  padding: 2px 8px;
  font-weight: 800;
  font-size: 0.5rem;
  letter-spacing: 0.08em;
  opacity: 0;
  transform: scale(0.8);
  transition: all 300ms var(--ease-bounce);
}
.terminal-copied.visible {
  opacity: 1;
  transform: scale(1);
}

/* ─── CTA ────────────────────────────────────────────── */
#cta {
  min-height: 100vh;
  border-top: 1px solid rgba(245, 240, 225, 0.06);
}

/* CTA council avatar row */
.cta-council-row {
  display: flex;
  gap: 6px;
  margin-bottom: 1.5rem;
  justify-content: center;
  min-height: 40px;
}
.cta-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  overflow: hidden;
  border: 2px solid var(--accent-gold);
  opacity: 0;
  transform: scale(0.5) translateY(8px);
}
.cta-avatar.bounce-in {
  animation: ctaBounceIn 400ms var(--ease-bounce) forwards;
}
@keyframes ctaBounceIn {
  to { opacity: 1; transform: scale(1) translateY(0); }
}
.cta-avatar img { width: 100%; height: 100%; object-fit: cover; }

.cta-label {
  font-size: 0.55rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  color: var(--accent-gold);
  margin-bottom: 0.5rem;
  min-height: 1.2em;
}
.cta-score {
  font-size: 0.8rem;
  font-weight: 800;
  margin-bottom: 2rem;
  min-height: 1.2em;
}
.cta-empty {
  font-size: 0.5rem;
  font-weight: 400;
  color: var(--text-muted);
  letter-spacing: 0.06em;
  margin-bottom: 2rem;
}
.cta-empty a {
  color: var(--accent-gold);
  text-decoration: none;
  font-weight: 700;
  letter-spacing: 0.1em;
}
.cta-empty a:hover { text-decoration: underline; }

.cta-start {
  font-family: 'Courier New', monospace;
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 0.15em;
  color: var(--accent-gold);
  margin-top: 1rem;
}

/* ─── Utility ────────────────────────────────────────── */
@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0ms !important;
    transition-duration: 0ms !important;
  }
  body.shaking { animation: none !important; }
  .flip-card.flipped .flip-card-inner {
    transition: none !important;
  }
}

@media (max-width: 640px) {
  .hands-container { gap: 2rem; }
  .hand { font-size: 3rem; }
  .slop-grid { flex-direction: column; align-items: center; }
  .category-row { flex-wrap: wrap; }
  .category-label { width: auto; text-align: left; }
  .loop-container { flex-wrap: wrap; justify-content: center; }
  .cta-council-row { flex-wrap: wrap; }
}
</style>
</head>
<body>

<!-- ═══ HERO ═══ -->
<section id="hero" data-testid="hero-section">
  <p class="hero-title">Pick a hand.</p>
  <div class="hands-container">
    <span class="hand" data-testid="hand-left" onclick="doSlap()">&#x1F91A;</span>
    <span class="hand" data-testid="hand-right" onclick="doSlap()">&#x270B;</span>
  </div>
  <p class="hero-whisper" id="heroWhisper">AI designs look the same. This fixes that.</p>
  <div class="scroll-indicator" id="scrollIndicator">&#8595; SCROLL</div>
</section>

<!-- SLAP! Flash Overlay -->
<div class="slap-flash" id="slapFlash"><h1>SLAP!</h1></div>

<!-- ═══ PROBLEM ═══ -->
<section id="problem" data-testid="problem-section">
  <p class="problem-title">Nobody slapped this.</p>
  <div class="slop-grid">
    <!-- Card 1: Landing Page archetype -->
    <div class="slop-card" data-testid="slop-card-1">
      <div class="slop-card-inner">
        <div class="slop-design archetype-landing">
          <div class="fake-hero-banner"></div>
          <div class="fake-headline"></div>
          <div class="fake-text"></div>
          <div class="fake-btn-pill"></div>
        </div>
        <div class="card-stamp">
          <div>
            <span class="card-stamp-label" style="color:var(--score-red)">SLOP</span>
            <span class="card-stamp-sublabel">Landing Page</span>
          </div>
          <span class="card-stamp-score" style="color:var(--score-red)">3/10</span>
          <div class="card-stamp-dots">
            <div class="dot" style="background:var(--score-red)"></div>
            <div class="dot" style="background:var(--score-red)"></div>
            <div class="dot" style="background:var(--score-red)"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Card 2: Dashboard archetype -->
    <div class="slop-card" data-testid="slop-card-2">
      <div class="slop-card-inner">
        <div class="slop-design archetype-dashboard">
          <div class="fake-metrics">
            <div class="fake-metric"></div>
            <div class="fake-metric"></div>
            <div class="fake-metric"></div>
            <div class="fake-metric"></div>
          </div>
          <div class="fake-chart"></div>
        </div>
        <div class="card-stamp">
          <div>
            <span class="card-stamp-label" style="color:var(--score-red)">SLOP</span>
            <span class="card-stamp-sublabel">Dashboard</span>
          </div>
          <span class="card-stamp-score" style="color:var(--score-red)">3/10</span>
          <div class="card-stamp-dots">
            <div class="dot" style="background:var(--score-red)"></div>
            <div class="dot" style="background:var(--score-red)"></div>
            <div class="dot" style="background:var(--score-red)"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Card 3: Card Gallery archetype — 3D flip -->
    <div class="slop-card flip-card" data-testid="slop-card-transform" id="transformCard">
      <div class="flip-card-inner" id="flipCardInner">
        <!-- Front: SLOP gallery -->
        <div class="flip-card-front">
          <div class="slop-design archetype-gallery">
            <div class="fake-card-grid">
              <div class="fake-gallery-card">
                <div class="fake-img"></div>
                <div class="fake-card-text"></div>
                <div class="fake-card-text" style="width:60%"></div>
              </div>
              <div class="fake-gallery-card">
                <div class="fake-img"></div>
                <div class="fake-card-text"></div>
                <div class="fake-card-text" style="width:60%"></div>
              </div>
              <div class="fake-gallery-card">
                <div class="fake-img"></div>
                <div class="fake-card-text"></div>
                <div class="fake-card-text" style="width:60%"></div>
              </div>
            </div>
          </div>
          <div class="card-stamp">
            <div>
              <span class="card-stamp-label" style="color:var(--score-red)">SLOP</span>
              <span class="card-stamp-sublabel">Card Gallery</span>
            </div>
            <span class="card-stamp-score" style="color:var(--score-red)">3/10</span>
            <div class="card-stamp-dots">
              <div class="dot" style="background:var(--score-red)"></div>
              <div class="dot" style="background:var(--score-red)"></div>
              <div class="dot" style="background:var(--score-red)"></div>
            </div>
          </div>
        </div>
        <!-- Back: SLAP design -->
        <div class="flip-card-back">
          <div class="slap-design">
            <div class="fake-headline"></div>
            <div class="fake-bar"></div>
            <div class="fake-text"></div>
            <div class="fake-text" style="width:40%"></div>
            <div class="fake-bar"></div>
            <div class="fake-btn"></div>
          </div>
          <div class="card-stamp">
            <div>
              <span class="card-stamp-label" style="color:var(--accent-gold)">SLAP!</span>
              <span class="card-stamp-sublabel" style="color:var(--accent-gold)">Reviewed</span>
            </div>
            <span class="card-stamp-score" style="color:var(--score-green)">8/10</span>
            <div class="card-stamp-dots">
              <div class="dot" style="background:var(--score-green)"></div>
              <div class="dot" style="background:var(--score-green)"></div>
              <div class="dot" style="background:var(--score-green)"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ═══ COUNCIL ═══ -->
<section id="council" data-testid="council-section" style="justify-content:flex-start;padding-top:3rem;">
  <p class="council-title">Pick your hands.</p>
  <button class="dice-btn" data-testid="dice-roll" onclick="rollDice()">
    <span class="dice-icon" id="diceIcon">&#x1F3B2;</span> ROLL THE DICE
  </button>

  <!-- Experts -->
  <div class="expert-row" id="expertRow"></div>

  <!-- Persona categories -->
  <div id="personaRows"></div>

  <!-- Live Preview -->
  <div class="live-preview" id="livePreview">
    <div id="previewFindings"></div>
    <div class="preview-score-bar">
      <div class="odometer-container" id="odometerContainer">
        <span class="odometer-static" id="previewScore" style="color:var(--score-yellow)">&mdash;</span>
      </div>
      <span class="score-delta" id="scoreDelta"></span>
      <span class="preview-score-label">COUNCIL SCORE</span>
    </div>
  </div>

  <!-- Council Bar (sticky bottom) -->
  <div class="council-bar" data-testid="council-bar">
    <span class="council-bar-label">YOUR CORNER</span>
    <div class="council-bar-avatars" id="councilBarAvatars"></div>
    <div class="council-bar-actions">
      <button class="council-bar-btn btn-reroll" onclick="rollDice()">&#x1F3B2; REROLL</button>
      <button class="council-bar-btn btn-keep" data-testid="keep-council" onclick="keepCouncil()">KEEP &amp; CONTINUE &#x2192;</button>
    </div>
  </div>
</section>

<!-- ═══ GAMELOOP ═══ -->
<section id="gameloop" data-testid="gameloop-section">
  <div class="loop-container">
    <div class="loop-step active" data-step="0"><span class="loop-icon">&#x1F3A8;</span><span class="loop-label">Design</span></div>
    <span class="loop-arrow">&#x2192;</span>
    <div class="loop-step" data-step="1"><span class="loop-icon">&#x1F91A;</span><span class="loop-label">Pick</span></div>
    <span class="loop-arrow">&#x2192;</span>
    <div class="loop-step" data-step="2"><span class="loop-icon">&#x1F4AC;</span><span class="loop-label">Slap</span></div>
    <span class="loop-arrow">&#x2192;</span>
    <div class="loop-step" data-step="3"><span class="loop-icon">&#x1F504;</span><span class="loop-label">Swap</span></div>
    <span class="loop-arrow">&#x2192;</span>
    <div class="loop-step" data-step="4"><span class="loop-icon">&#x1F4CB;</span><span class="loop-label">Receipt</span></div>
  </div>
  <p class="loop-caption">Pick. Slap. Read. Swap. Repeat.</p>
</section>

<!-- ═══ PIPELINE ═══ -->
<section id="pipeline" data-testid="pipeline-section">
  <p class="pipeline-title">Every slap comes with a receipt.</p>
  <div class="terminal">
    <div class="terminal-header">
      <div class="terminal-dot" style="background:#FF6B6B"></div>
      <div class="terminal-dot" style="background:#FFD93D"></div>
      <div class="terminal-dot" style="background:#6BCB77"></div>
      <span class="terminal-title">ITERATION RECEIPT</span>
    </div>
    <div class="terminal-body" id="terminalBody">
      <div class="terminal-line" data-line="0"><span class="terminal-prompt">&gt;</span> Review complete. Council score: <span class="terminal-yellow">7.2</span>/10</div>
      <div class="terminal-line" data-line="1">&nbsp;</div>
      <div class="terminal-line" data-line="2"><span class="terminal-red">&#x1F534;</span> Frank: <span class="terminal-red">"Pricing takes 3 clicks to compare"</span></div>
      <div class="terminal-line" data-line="3"><span class="terminal-green">&#x1F7E2;</span> Marcus: <span class="terminal-green">"Color contrast passes. Readable."</span></div>
      <div class="terminal-line" data-line="4"><span class="terminal-yellow">&#x1F7E1;</span> Dorothy: <span class="terminal-yellow">"What does 'iterate' mean?"</span></div>
      <div class="terminal-line" data-line="5">&nbsp;</div>
      <div class="terminal-line" data-line="6">
        <div class="terminal-context">
          <div class="terminal-gold">&#x250C;&#x2500; COPY CONTEXT FOR NEXT ROUND &#x2500;&#x2500;&#x2500;&#x2510;</div>
          <div>Fix: 1-click pricing comparison</div>
          <div>Fix: Replace jargon ("iterate" &#x2192; "next")</div>
          <div>Keep: Headline, color contrast</div>
          <div>Swap: Frank &#x2192; Diana</div>
          <div class="terminal-gold">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</div>
        </div>
      </div>
      <div class="terminal-line" data-line="7">&nbsp;</div>
      <div class="terminal-line" data-line="8"><span class="terminal-copied" id="copiedBadge">COPIED &#x2713;</span></div>
    </div>
  </div>
</section>

<!-- ═══ CTA ═══ -->
<section id="cta" data-testid="cta-section">
  <!-- Council avatars -->
  <div class="cta-council-row" id="ctaCouncilRow"></div>
  <!-- Dynamic label -->
  <p class="cta-label" id="ctaLabel"></p>
  <!-- Estimated score -->
  <p class="cta-score" id="ctaScore"></p>
  <!-- Empty state -->
  <div class="cta-empty" id="ctaEmpty" style="display:none">
    No council yet. <a href="#council">&#8593; SCROLL UP</a>
  </div>
  <!-- Hands -->
  <div class="hands-container" style="opacity:1;animation:none">
    <span class="hand" data-testid="cta-hand-left" onclick="enterApp()">&#x1F91A;</span>
    <span class="hand" data-testid="cta-hand-right" onclick="enterApp()">&#x270B;</span>
  </div>
  <p class="cta-start">Start reviewing.</p>
</section>

<script>
// ─── Reviewer Data ──────────────────────────────────
const EXPERTS = [
  { id:'marketing', name:'MARKETING', role:'Positioning', color:'#FF6B6B', icon:'\u{1F3AF}', bias:'Does this sell?', style:'shapes' },
  { id:'ux', name:'UX', role:'Usability', color:'#4ECDC4', icon:'\u{1F3A8}', bias:'Can every user succeed?', style:'shapes' },
  { id:'product', name:'PRODUCT', role:'Value Prop', color:'#FFD93D', icon:'\u{1F4E6}', bias:'Worth the complexity?', style:'shapes' },
  { id:'technical', name:'TECHNICAL', role:'Performance', color:'#95E1D3', icon:'\u{1F527}', bias:'Will this work on slow connections?', style:'shapes' },
  { id:'design', name:'DESIGN', role:'Aesthetics', color:'#F38181', icon:'\u{2728}', bias:'Intentional or template?', style:'shapes' },
];

const PERSONAS = [
  { id:'marcus', name:'Marcus', role:'Colorblind Dev', cat:'Accessibility', color:'#4ECDC4', bias:'Color-only = invisible to me.' },
  { id:'elena', name:'Elena', role:'Screen Reader', cat:'Accessibility', color:'#7B68EE', bias:'No label? Doesn\'t exist.' },
  { id:'priya', name:'Priya', role:'Motor Control', cat:'Accessibility', color:'#DDA0DD', bias:'Tiny targets = missed clicks.' },
  { id:'dorothy', name:'Dorothy', role:'Just Works', cat:'Tech Spectrum', color:'#6BCB77', bias:'What does OAuth mean?' },
  { id:'kevin', name:'Kevin', role:'Zero Patience', cat:'Tech Spectrum', color:'#FF8C00', bias:'2+ taps? Already gone.' },
  { id:'raj', name:'Raj', role:'Power User', cat:'Tech Spectrum', color:'#20B2AA', bias:'Where are the shortcuts?' },
  { id:'carlos', name:'Carlos', role:'CEO', cat:'Role-Based', color:'#DAA520', bias:'ROI in the first scroll.' },
  { id:'jasmine', name:'Jasmine', role:'Support Rep', cat:'Role-Based', color:'#87CEEB', bias:'3 tickets/day about this.' },
  { id:'tommy', name:'Tommy', role:'Intern Day 3', cat:'Role-Based', color:'#FF69B4', bias:'10 min clicking, still lost.' },
  { id:'frank', name:'Frank', role:'Zero Patience', cat:'Emotional', color:'#FF6B6B', bias:'Already annoyed. Every click worse.' },
  { id:'diana', name:'Diana', role:'Craft Lover', cat:'Emotional', color:'#BA55D3', bias:'I notice when someone cared.' },
  { id:'sarah', name:'Sarah', role:'Trusts Nothing', cat:'Emotional', color:'#CD853F', bias:'Where\'s the privacy policy?' },
  { id:'sam', name:'Sam', role:'One Thumb', cat:'Context', color:'#9B59B6', bias:'Bumpy train. One thumb. Go.' },
  { id:'maya', name:'Maya', role:'30 Seconds', cat:'Context', color:'#F0E68C', bias:'Kid meltdown in 30 sec.' },
  { id:'mike', name:'Mike', role:'Screen Sharing', cat:'Context', color:'#708090', bias:'Team watching. Don\'t embarrass me.' },
  { id:'yuki', name:'Yuki', role:'Aesthetic First', cat:'Cultural Taste', color:'#FFB7C5', bias:'Not beautiful? Don\'t trust it.' },
  { id:'dex', name:'Dex', role:'Subculture', cat:'Cultural Taste', color:'#32CD32', bias:'Corporate = enemy.' },
  { id:'nora', name:'Nora', role:'Expects Luxury', cat:'Cultural Taste', color:'#C4A35A', bias:'Not premium? Not paying premium.' },
];

const SAMPLE_FINDINGS = {
  marketing: { text: 'CTA needs urgency language.', light: 'yellow' },
  ux: { text: 'CTA below fold \u2014 40% miss it.', light: 'red' },
  product: { text: 'Value prop clear in 3 seconds.', light: 'green' },
  technical: { text: 'Images unoptimized \u2014 4s load.', light: 'red' },
  design: { text: 'Typography hierarchy is strong.', light: 'green' },
  marcus: { text: 'Color contrast passes. Readable.', light: 'green' },
  elena: { text: 'Missing aria-labels on icons.', light: 'red' },
  priya: { text: 'Touch targets are generous.', light: 'green' },
  dorothy: { text: 'What does "iterate" mean?', light: 'yellow' },
  kevin: { text: 'Loads fast. Good.', light: 'green' },
  raj: { text: 'No keyboard shortcuts at all.', light: 'yellow' },
  carlos: { text: 'ROI unclear in first scroll.', light: 'red' },
  jasmine: { text: 'FAQ section would cut tickets.', light: 'yellow' },
  tommy: { text: 'Fun design! Easy to explore.', light: 'green' },
  frank: { text: 'Pricing takes 3 clicks. Furious.', light: 'red' },
  diana: { text: 'Someone cared about the details.', light: 'green' },
  sarah: { text: 'No testimonials? Don\'t trust it.', light: 'red' },
  sam: { text: 'One-thumb friendly. Approved.', light: 'green' },
  maya: { text: 'Clear enough for 30 seconds.', light: 'green' },
  mike: { text: 'Professional. Safe to screen-share.', light: 'green' },
  yuki: { text: 'Beautiful but needs more polish.', light: 'yellow' },
  dex: { text: 'Too corporate. Show some edge.', light: 'red' },
  nora: { text: 'Doesn\'t feel premium enough.', light: 'yellow' },
};

function avatarUrl(r) {
  const style = r.style || 'adventurer';
  const seed = style === 'shapes' ? r.id + '-expert' : r.id;
  const hex = r.color.replace('#','');
  return `https://api.dicebear.com/9.x/${style}/svg?seed=${seed}&backgroundColor=${hex}`;
}

// ─── State ──────────────────────────────────────────
let selected = new Set();
let previousScore = null;
let activeFindingIds = new Set();
let deltaTimeout = null;

// ─── Build Reviewer Grid ────────────────────────────
function buildGrid() {
  const eRow = document.getElementById('expertRow');
  EXPERTS.forEach(e => {
    eRow.appendChild(makeBubble(e));
  });

  const cats = ['Accessibility','Tech Spectrum','Role-Based','Emotional','Context','Cultural Taste'];
  const container = document.getElementById('personaRows');
  cats.forEach(cat => {
    const row = document.createElement('div');
    row.className = 'category-row';
    const label = document.createElement('span');
    label.className = 'category-label';
    label.textContent = cat;
    row.appendChild(label);
    PERSONAS.filter(p => p.cat === cat).forEach(p => {
      row.appendChild(makeBubble(p));
    });
    container.appendChild(row);
  });
}

function makeBubble(r) {
  const div = document.createElement('div');
  div.className = 'reviewer-bubble';
  div.dataset.id = r.id;
  div.innerHTML = `
    <img src="${avatarUrl(r)}" alt="${r.name}" loading="lazy">
    <div class="tooltip">
      <div class="tooltip-name" style="color:${r.color}">${r.name}</div>
      <div class="tooltip-role">${r.role}</div>
      <div class="tooltip-bias">"${r.bias}"</div>
    </div>
  `;
  div.addEventListener('click', () => toggleReviewer(r.id));
  return div;
}

function toggleReviewer(id) {
  if (selected.has(id)) selected.delete(id);
  else selected.add(id);
  updateUI();
}

// ─── Compute score ──────────────────────────────────
function computeScore() {
  let totalScore = 0, count = 0;
  selected.forEach(id => {
    const f = SAMPLE_FINDINGS[id];
    if (!f) return;
    const score = f.light === 'green' ? 8 : f.light === 'yellow' ? 6 : 3;
    totalScore += score; count++;
  });
  return count > 0 ? totalScore / count : null;
}

function scoreColor(n) {
  return n >= 7 ? '#6BCB77' : n >= 5 ? '#FFD93D' : '#FF6B6B';
}

// ─── Odometer score update ──────────────────────────
function updateOdometer(newVal) {
  const container = document.getElementById('odometerContainer');
  if (newVal === null) {
    container.innerHTML = '<span class="odometer-static" style="color:var(--score-yellow)">\u2014</span>';
    return;
  }

  const text = newVal.toFixed(1) + '/10';
  const color = scoreColor(newVal);
  const prevContent = container.textContent;

  container.innerHTML = '';
  for (let i = 0; i < text.length; i++) {
    const char = text[i];
    const span = document.createElement('span');
    if (char >= '0' && char <= '9') {
      span.className = 'odometer-digit';
      if (prevContent[i] !== char) {
        span.classList.add('rolling');
      }
    } else {
      span.className = 'odometer-static';
    }
    span.style.color = color;
    span.textContent = char;
    container.appendChild(span);
  }
}

// ─── Score delta badge ──────────────────────────────
function showDelta(oldScore, newScore) {
  if (oldScore === null || newScore === null) return;
  const delta = newScore - oldScore;
  if (Math.abs(delta) < 0.05) return;

  const el = document.getElementById('scoreDelta');
  const sign = delta > 0 ? '+' : '';
  el.textContent = sign + delta.toFixed(1);
  el.className = 'score-delta visible ' + (delta > 0 ? 'positive' : 'negative');

  clearTimeout(deltaTimeout);
  deltaTimeout = setTimeout(() => {
    el.classList.add('fading');
    el.classList.remove('visible');
  }, 1500);
}

// ─── Update UI (reactive) ───────────────────────────
function updateUI() {
  // Update bubble states
  document.querySelectorAll('.reviewer-bubble').forEach(b => {
    b.classList.toggle('selected', selected.has(b.dataset.id));
  });

  // Update council bar avatars
  const bar = document.getElementById('councilBarAvatars');
  bar.innerHTML = '';
  let i = 0;
  selected.forEach(id => {
    const r = [...EXPERTS, ...PERSONAS].find(x => x.id === id);
    if (!r) return;
    const av = document.createElement('div');
    av.className = 'council-bar-avatar';
    av.style.animationDelay = (i * 60) + 'ms';
    av.style.borderColor = r.color;
    av.innerHTML = `<img src="${avatarUrl(r)}" alt="${r.name}">`;
    bar.appendChild(av);
    i++;
  });

  // Update live preview — reactive per reviewer
  const preview = document.getElementById('livePreview');
  const findings = document.getElementById('previewFindings');
  const newIds = new Set(selected);

  if (selected.size >= 3) {
    preview.classList.add('active');

    // Remove findings for deselected reviewers
    const toRemove = [];
    activeFindingIds.forEach(id => {
      if (!newIds.has(id)) toRemove.push(id);
    });
    toRemove.forEach(id => {
      const el = findings.querySelector(`[data-finding-id="${id}"]`);
      if (el) {
        el.classList.add('exiting');
        setTimeout(() => el.remove(), 250);
      }
      activeFindingIds.delete(id);
    });

    // Add findings for newly selected reviewers
    selected.forEach(id => {
      if (activeFindingIds.has(id)) return;
      const r = [...EXPERTS, ...PERSONAS].find(x => x.id === id);
      const f = SAMPLE_FINDINGS[id];
      if (!r || !f) return;
      const lightColor = f.light === 'green' ? '#6BCB77' : f.light === 'yellow' ? '#FFD93D' : '#FF6B6B';
      const div = document.createElement('div');
      div.className = 'preview-finding entering';
      div.dataset.findingId = id;
      div.innerHTML = `
        <div class="preview-light" style="background:${lightColor}"></div>
        <div><span class="preview-name" style="color:${r.color}">${r.name}:</span> ${f.text}</div>
      `;
      findings.appendChild(div);
      activeFindingIds.add(id);
    });

    // Score — odometer + delta
    const newScore = computeScore();
    updateOdometer(newScore);
    showDelta(previousScore, newScore);
    previousScore = newScore;
  } else {
    preview.classList.remove('active');
    // Clear all findings
    findings.innerHTML = '';
    activeFindingIds.clear();
    previousScore = null;
    updateOdometer(null);
  }

  // Update CTA section
  updateCTA();
}

// ─── CTA section ────────────────────────────────────
function updateCTA() {
  const row = document.getElementById('ctaCouncilRow');
  const label = document.getElementById('ctaLabel');
  const score = document.getElementById('ctaScore');
  const empty = document.getElementById('ctaEmpty');

  row.innerHTML = '';

  if (selected.size === 0) {
    label.textContent = '';
    score.textContent = '';
    empty.style.display = 'block';
    return;
  }

  empty.style.display = 'none';

  // Count experts and personas
  let expertCount = 0, personaCount = 0;
  selected.forEach(id => {
    if (EXPERTS.find(e => e.id === id)) expertCount++;
    else personaCount++;
  });

  // Avatars with staggered bounce-in
  let i = 0;
  selected.forEach(id => {
    const r = [...EXPERTS, ...PERSONAS].find(x => x.id === id);
    if (!r) return;
    const av = document.createElement('div');
    av.className = 'cta-avatar';
    av.innerHTML = `<img src="${avatarUrl(r)}" alt="${r.name}">`;
    av.style.borderColor = r.color;
    row.appendChild(av);
    const delay = i * 60;
    setTimeout(() => av.classList.add('bounce-in'), delay);
    i++;
  });

  // Label: "{X} experts. {Y} personas. Ready."
  label.textContent = `${expertCount} expert${expertCount !== 1 ? 's' : ''}. ${personaCount} persona${personaCount !== 1 ? 's' : ''}. Ready.`;

  // Estimated score
  const avg = computeScore();
  if (avg !== null) {
    score.textContent = avg.toFixed(1) + '/10';
    score.style.color = scoreColor(avg);
  } else {
    score.textContent = '';
  }
}

// ─── Dice Roll ──────────────────────────────────────
function rollDice() {
  const icon = document.getElementById('diceIcon');
  icon.classList.remove('rolling');
  void icon.offsetWidth;
  icon.classList.add('rolling');

  const shuffledE = [...EXPERTS].sort(() => Math.random() - 0.5);
  const expertCount = Math.random() > 0.5 ? 3 : 2;
  const pickedExperts = shuffledE.slice(0, expertCount);

  const cats = ['Accessibility','Tech Spectrum','Role-Based','Emotional','Context','Cultural Taste'];
  const shuffledCats = [...cats].sort(() => Math.random() - 0.5);
  const personaCount = expertCount === 2 ? 4 : 3;
  const pickedPersonas = [];
  for (let j = 0; j < personaCount && j < shuffledCats.length; j++) {
    const catPersonas = PERSONAS.filter(p => p.cat === shuffledCats[j]);
    pickedPersonas.push(catPersonas[Math.floor(Math.random() * catPersonas.length)]);
  }

  // Clear and reset for clean diff
  activeFindingIds.clear();
  document.getElementById('previewFindings').innerHTML = '';
  previousScore = null;

  selected.clear();
  pickedExperts.forEach(e => selected.add(e.id));
  pickedPersonas.forEach(p => selected.add(p.id));
  updateUI();
}

// ─── SLAP! Hero ─────────────────────────────────────
let hasSlapped = false;
function doSlap() {
  if (hasSlapped) return;
  hasSlapped = true;

  // Step 1: Screen shake (150ms)
  document.body.classList.add('shaking');

  // Step 2: After shake, gold flash (200ms)
  setTimeout(() => {
    document.body.classList.remove('shaking');
    const flash = document.getElementById('slapFlash');
    flash.classList.add('active');

    setTimeout(() => {
      flash.classList.remove('active');
      // Step 3: Whisper fade-in
      document.getElementById('heroWhisper').classList.add('visible');
      document.getElementById('scrollIndicator').classList.add('visible');
    }, 200);
  }, 150);
}

// ─── Problem Section — 3D flip on scroll ────────────
let transformed = false;
function checkProblemScroll() {
  if (transformed) return;
  const card = document.getElementById('transformCard');
  const rect = card.getBoundingClientRect();
  if (rect.top < window.innerHeight * 0.7) {
    transformed = true;
    card.classList.add('flipped');
  }
}

// Slop cards scroll reveal
function checkSlopCards() {
  document.querySelectorAll('.slop-card').forEach((card, i) => {
    const rect = card.getBoundingClientRect();
    if (rect.top < window.innerHeight * 0.85) {
      setTimeout(() => card.classList.add('visible'), i * 150);
    }
  });
}

// ─── Gameloop Animation — gold pulse on Slap step ───
let loopStep = 0;
function animateLoop() {
  document.querySelectorAll('.loop-step').forEach(s => {
    s.classList.remove('active');
    s.classList.remove('slap-active');
  });
  const current = document.querySelector(`.loop-step[data-step="${loopStep}"]`);
  current.classList.add('active');
  // Gold emphasis when step 2 (Slap) is active
  if (loopStep === 2) {
    current.classList.add('slap-active');
  }
  loopStep = (loopStep + 1) % 5;
}
setInterval(animateLoop, 1500);

// ─── Terminal Animation ─────────────────────────────
let terminalPlayed = false;
function checkTerminal() {
  if (terminalPlayed) return;
  const section = document.getElementById('pipeline');
  const rect = section.getBoundingClientRect();
  if (rect.top < window.innerHeight * 0.7) {
    terminalPlayed = true;
    const lines = document.querySelectorAll('.terminal-line');
    lines.forEach((line, i) => {
      setTimeout(() => line.classList.add('visible'), i * 400);
    });
    setTimeout(() => {
      document.getElementById('copiedBadge').classList.add('visible');
    }, lines.length * 400 + 500);
  }
}

// ─── Keep & Continue ────────────────────────────────
function keepCouncil() {
  const council = Array.from(selected);
  localStorage.setItem('slap-default-council', JSON.stringify(council));
  document.getElementById('cta').scrollIntoView({ behavior: 'smooth' });
}

function enterApp() {
  if (selected.size > 0) {
    localStorage.setItem('slap-default-council', JSON.stringify(Array.from(selected)));
  }
  alert('Navigate to #/gallery (in real app)');
}

// ─── Init ───────────────────────────────────────────
buildGrid();
updateCTA(); // Show empty state on load
window.addEventListener('scroll', () => {
  checkSlopCards();
  checkProblemScroll();
  checkTerminal();
});
setTimeout(() => checkSlopCards(), 100);
</script>
</body>
</html>
