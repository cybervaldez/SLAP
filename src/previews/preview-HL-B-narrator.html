<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SLAP! — Variation B: The Narrator (Chin as Active Narration Strip)</title>
<style>
/* ── Reset ─────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

/* ── Design Tokens ─────────────────────────────────────── */
:root {
  --bg: #0D0D1A;
  --surface: #161628;
  --accent: #FFD000;
  --text: #F5F0E1;
  --text-dim: rgba(245, 240, 225, 0.4);
  --text-mid: rgba(245, 240, 225, 0.6);
  --border: rgba(245, 240, 225, 0.12);
  --font: 'Courier New', monospace;
  --red: #FF6B6B;
  --yellow: #FFD93D;
  --green: #6BCB77;

  --chin-idle: 56px;
  --chin-spotlight: 72px;
  --chin-tour: 96px;
  --chin-height: var(--chin-idle);

  --bezel: 8px;
  --bezel-radius: 10px;

  --transition-chin: 300ms ease;
}

body {
  font-family: var(--font);
  background: #000;
  color: var(--text);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 32px;
}

/* ── iMac Bezel Frame (body::after approach) ───────────── */
.imac-frame {
  position: relative;
  width: 780px;
  max-width: 100%;
  background: var(--bg);
  border: var(--bezel) solid #2A2A40;
  border-radius: var(--bezel-radius);
  overflow: hidden;
  box-shadow:
    0 0 0 1px rgba(255,208,0,0.08),
    0 20px 60px rgba(0,0,0,0.6),
    inset 0 0 80px rgba(13,13,26,0.5);
}

.imac-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: calc(var(--bezel-radius) - var(--bezel));
  border: 1px solid rgba(255,208,0,0.06);
  pointer-events: none;
  z-index: 100;
}

/* ── Mode Label ────────────────────────────────────────── */
.mode-label {
  position: absolute;
  top: 52px;
  left: 16px;
  font-size: 0.55rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--accent);
  background: rgba(255,208,0,0.08);
  border: 1px solid rgba(255,208,0,0.2);
  padding: 2px 8px;
  border-radius: 3px;
  z-index: 50;
  transition: all 300ms ease;
}

/* ── TopBar ────────────────────────────────────────────── */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  background: rgba(22,22,40,0.95);
  border-bottom: 1px solid var(--border);
  position: relative;
  z-index: 30;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.topbar-left .back-btn {
  font-family: var(--font);
  font-size: 0.75rem;
  color: var(--text-dim);
  background: none;
  border: 1px solid var(--border);
  padding: 2px 8px;
  border-radius: 3px;
  cursor: pointer;
  transition: color 200ms;
}
.topbar-left .back-btn:hover { color: var(--accent); }

.topbar-left .page-name {
  font-size: 0.7rem;
  font-weight: 700;
  color: var(--text);
  letter-spacing: 0.04em;
}

.topbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

.version-badge {
  font-size: 0.6rem;
  font-weight: 700;
  padding: 3px 8px;
  border-radius: 3px;
  letter-spacing: 0.04em;
  border: 1px solid var(--border);
  color: var(--text-mid);
  background: transparent;
  cursor: pointer;
  transition: all 200ms;
}
.version-badge:hover {
  border-color: var(--accent);
  color: var(--accent);
}
.version-badge.active {
  background: rgba(255,208,0,0.1);
  border-color: var(--accent);
  color: var(--accent);
}
.version-badge .score {
  color: var(--text-dim);
  margin-left: 2px;
}
.version-badge.active .score {
  color: var(--accent);
}

.tour-btn {
  font-family: var(--font);
  font-size: 0.6rem;
  font-weight: 700;
  padding: 4px 12px;
  border-radius: 3px;
  border: 1px solid var(--accent);
  background: transparent;
  color: var(--accent);
  cursor: pointer;
  letter-spacing: 0.05em;
  transition: all 200ms;
}
.tour-btn:hover {
  background: rgba(255,208,0,0.1);
}

/* Tour button pulse during tour mode */
.tour-btn.pulsing {
  animation: tourPulse 1.5s ease-in-out infinite;
}
@keyframes tourPulse {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(255,208,0,0.4);
  }
  50% {
    box-shadow: 0 0 12px 4px rgba(255,208,0,0.25);
    background: rgba(255,208,0,0.12);
  }
}

/* ── Main Content Area ─────────────────────────────────── */
.content-area {
  display: flex;
  position: relative;
  min-height: 460px;
}

/* ── Canvas (page sections) ────────────────────────────── */
.canvas {
  flex: 1;
  padding: 16px;
  padding-top: 28px;
  position: relative;
  overflow: hidden;
}

.section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 16px 20px;
  margin-bottom: 12px;
  min-height: 90px;
  transition: box-shadow 300ms ease, border-color 300ms ease;
  position: relative;
  z-index: 10;
}

.section .section-label {
  font-size: 0.55rem;
  font-weight: 700;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 8px;
}

.section h3 {
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 6px;
}

.section p {
  font-size: 0.65rem;
  line-height: 1.6;
  color: var(--text-mid);
}

/* Browse hover effect */
.section.hovered {
  box-shadow: 0 0 16px rgba(255,208,0,0.15), inset 0 0 0 1px rgba(255,208,0,0.2);
  border-color: rgba(255,208,0,0.3);
}
.section.hovered h3 {
  text-decoration: underline;
  text-decoration-color: var(--accent);
  text-underline-offset: 3px;
}

/* Section-specific content */
.pricing-tiers {
  display: flex;
  gap: 12px;
  margin-top: 8px;
}
.tier {
  flex: 1;
  text-align: center;
  padding: 8px 4px;
  border: 1px solid var(--border);
  border-radius: 4px;
  font-size: 0.6rem;
}
.tier .price {
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--accent);
  margin: 4px 0;
}
.tier .plan-name {
  color: var(--text-dim);
  font-size: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.feature-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  margin-top: 8px;
}
.feature-item {
  font-size: 0.55rem;
  color: var(--text-mid);
  padding: 4px 6px;
  background: rgba(255,255,255,0.02);
  border-radius: 3px;
}
.feature-item::before {
  content: '+ ';
  color: var(--green);
}

.cta-area {
  text-align: center;
  margin-top: 10px;
}
.cta-button {
  display: inline-block;
  padding: 8px 28px;
  background: var(--accent);
  color: var(--bg);
  font-family: var(--font);
  font-size: 0.65rem;
  font-weight: 700;
  border-radius: 4px;
  letter-spacing: 0.05em;
}
.cta-subtext {
  font-size: 0.5rem;
  color: var(--text-dim);
  margin-top: 6px;
}

/* ── Bubble Rail ───────────────────────────────────────── */
.bubble-rail {
  width: 48px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 16px 0;
  position: relative;
  z-index: 20;
}

.bubble {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 1.5px solid var(--border);
  background: transparent;
  transition: all 300ms ease;
  cursor: pointer;
  position: relative;
}

.bubble::after {
  content: '';
  position: absolute;
  inset: 2px;
  border-radius: 50%;
  background: transparent;
  transition: background 300ms ease;
}

.bubble.active {
  border-color: var(--accent);
}
.bubble.active::after {
  background: var(--accent);
}

.bubble.has-finding {
  border-color: var(--text-mid);
}
.bubble.has-finding::after {
  background: var(--text-mid);
}

/* ── SVG Spotlight Overlay ─────────────────────────────── */
.spotlight-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 15;
  opacity: 0;
  transition: opacity 400ms ease;
}

.spotlight-overlay.visible {
  opacity: 1;
}

/* ── CHIN — The Narrator ───────────────────────────────── */
.chin {
  height: var(--chin-height);
  background: linear-gradient(180deg, #1A1A30 0%, #12121F 100%);
  border-top: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 0 20px;
  position: relative;
  transition: height var(--transition-chin);
  overflow: hidden;
}

/* Chin idle state */
.chin-idle {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  transition: opacity 200ms ease;
}
.chin-idle .brand {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: 0.1em;
}

/* Chin spotlight state */
.chin-spotlight {
  display: flex;
  align-items: center;
  gap: 12px;
  height: 100%;
  opacity: 0;
  position: absolute;
  top: 0; left: 0; right: 0;
  padding: 0 20px;
  transition: opacity 200ms ease;
}

.chin-spotlight .reviewer-avatar {
  width: 28px;
  height: 28px;
  min-width: 28px;
  border-radius: 50%;
  background: rgba(255,208,0,0.15);
  border: 1.5px solid var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.6rem;
  font-weight: 700;
  color: var(--accent);
}

.chin-spotlight .reviewer-info {
  flex: 1;
  min-width: 0;
}
.chin-spotlight .reviewer-name {
  font-size: 0.55rem;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: 0.06em;
  margin-bottom: 2px;
}
.chin-spotlight .finding-text {
  font-size: 0.6rem;
  color: var(--text);
  line-height: 1.4;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chin-spotlight .traffic-light {
  width: 10px;
  height: 10px;
  min-width: 10px;
  border-radius: 50%;
  margin-left: auto;
}
.traffic-light.red { background: var(--red); box-shadow: 0 0 6px var(--red); }
.traffic-light.yellow { background: var(--yellow); box-shadow: 0 0 6px var(--yellow); }
.traffic-light.green { background: var(--green); box-shadow: 0 0 6px var(--green); }

/* Chin tour state */
.chin-tour {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 4px;
  height: 100%;
  opacity: 0;
  position: absolute;
  top: 0; left: 0; right: 0;
  padding: 8px 20px;
  transition: opacity 200ms ease;
}

.chin-tour .tour-row1 {
  display: flex;
  align-items: center;
  gap: 8px;
}

.chin-tour .tour-avatar {
  width: 22px;
  height: 22px;
  min-width: 22px;
  border-radius: 50%;
  background: rgba(255,208,0,0.15);
  border: 1.5px solid var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.5rem;
  font-weight: 700;
  color: var(--accent);
}

.chin-tour .tour-reviewer-name {
  font-size: 0.5rem;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: 0.06em;
}

.chin-tour .tour-section-label {
  font-size: 0.5rem;
  font-weight: 700;
  color: var(--text-dim);
  letter-spacing: 0.08em;
  margin-left: 4px;
}
.chin-tour .tour-dash {
  color: var(--text-dim);
  font-size: 0.5rem;
}

.chin-tour .tour-step-counter {
  margin-left: auto;
  font-size: 0.5rem;
  font-weight: 700;
  color: var(--text-dim);
  letter-spacing: 0.04em;
}

.chin-tour .tour-row2 {
  padding-left: 30px;
}
.chin-tour .tour-finding {
  font-size: 0.55rem;
  font-style: italic;
  color: var(--text);
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chin-tour .tour-row3 {
  display: flex;
  align-items: center;
  gap: 12px;
  padding-left: 30px;
}

.chin-tour .progress-bar {
  display: flex;
  align-items: center;
  gap: 0;
  font-size: 0.55rem;
  letter-spacing: 1px;
}
.progress-bar .bar-filled {
  color: var(--accent);
}
.progress-bar .bar-empty {
  color: var(--text-dim);
}

.chin-tour .breadcrumb {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 0.5rem;
  letter-spacing: 0.06em;
}
.breadcrumb .crumb {
  color: var(--text-dim);
  transition: color 200ms ease;
}
.breadcrumb .crumb.active {
  color: var(--accent);
  font-weight: 700;
}
.breadcrumb .crumb-sep {
  color: var(--text-dim);
  font-size: 0.45rem;
}

/* ── State classes ─────────────────────────────────────── */
/* These control which chin content is visible */
.imac-frame[data-mode="browse"] .chin { --chin-height: var(--chin-idle); }
.imac-frame[data-mode="spotlight"] .chin { --chin-height: var(--chin-spotlight); }
.imac-frame[data-mode="tour"] .chin { --chin-height: var(--chin-tour); }

.imac-frame[data-mode="browse"] .chin-idle { opacity: 1; position: relative; }
.imac-frame[data-mode="browse"] .chin-spotlight { opacity: 0; pointer-events: none; }
.imac-frame[data-mode="browse"] .chin-tour { opacity: 0; pointer-events: none; }

.imac-frame[data-mode="spotlight"] .chin-idle { opacity: 0; position: absolute; pointer-events: none; }
.imac-frame[data-mode="spotlight"] .chin-spotlight { opacity: 1; position: relative; }
.imac-frame[data-mode="spotlight"] .chin-tour { opacity: 0; pointer-events: none; }

.imac-frame[data-mode="tour"] .chin-idle { opacity: 0; position: absolute; pointer-events: none; }
.imac-frame[data-mode="tour"] .chin-spotlight { opacity: 0; pointer-events: none; }
.imac-frame[data-mode="tour"] .chin-tour { opacity: 1; position: relative; }

/* ── Scanline CRT texture (subtle) ─────────────────────── */
.imac-frame::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.03) 2px,
    rgba(0,0,0,0.03) 4px
  );
  pointer-events: none;
  z-index: 99;
}

/* ── Info Banner ───────────────────────────────────────── */
.info-banner {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 9999;
  background: var(--accent);
  color: #0D0D1A;
  font-family: var(--font);
  font-size: 0.6rem;
  font-weight: 700;
  text-align: center;
  padding: 5px 16px;
  letter-spacing: 0.06em;
}
.info-banner code {
  background: rgba(0,0,0,0.1);
  padding: 1px 6px;
  border-radius: 3px;
  font-size: 0.58rem;
}
</style>
</head>
<body>

<div class="info-banner">
  SLAP! Preview &mdash; Variation B: The Narrator &mdash; Chin as Active Narration Strip
  &nbsp;<code>preview-HL-B-narrator.html</code>
</div>

<div class="imac-frame" id="frame" data-mode="browse">

  <!-- Mode Label -->
  <div class="mode-label" id="modeLabel">BROWSE</div>

  <!-- TopBar -->
  <div class="topbar">
    <div class="topbar-left">
      <button class="back-btn">&larr;</button>
      <span class="page-name">Example</span>
    </div>
    <div class="topbar-right">
      <button class="version-badge active">v1 <span class="score">5.2</span></button>
      <button class="version-badge">v2 <span class="score">6.8</span></button>
      <button class="tour-btn" id="tourBtn">&#9654; Tour</button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content-area">

    <!-- Canvas with sections -->
    <div class="canvas" id="canvas">

      <!-- Section 0: HERO -->
      <div class="section" id="sec-0" data-index="0">
        <div class="section-label">HERO</div>
        <h3>Ship Better Landing Pages, Faster</h3>
        <p>The AI-powered audit tool that spots conversion killers before your users bounce. Get actionable insights in seconds, not weeks.</p>
      </div>

      <!-- Section 1: FEATURES -->
      <div class="section" id="sec-1" data-index="1">
        <div class="section-label">FEATURES</div>
        <h3>Everything You Need</h3>
        <div class="feature-grid">
          <div class="feature-item">Smart Heatmaps</div>
          <div class="feature-item">Copy Analysis</div>
          <div class="feature-item">CTA Scoring</div>
          <div class="feature-item">A/B Variants</div>
        </div>
      </div>

      <!-- Section 2: PRICING -->
      <div class="section" id="sec-2" data-index="2">
        <div class="section-label">PRICING</div>
        <h3>Simple, Transparent Pricing</h3>
        <div class="pricing-tiers">
          <div class="tier">
            <div class="plan-name">Starter</div>
            <div class="price">$29</div>
          </div>
          <div class="tier">
            <div class="plan-name">Pro</div>
            <div class="price">$79</div>
          </div>
          <div class="tier">
            <div class="plan-name">Scale</div>
            <div class="price">$149</div>
          </div>
        </div>
      </div>

      <!-- Section 3: CTA -->
      <div class="section" id="sec-3" data-index="3">
        <div class="section-label">CTA</div>
        <h3>Ready to Improve Your Conversions?</h3>
        <div class="cta-area">
          <div class="cta-button">Get Started</div>
          <div class="cta-subtext">No credit card required</div>
        </div>
      </div>

      <!-- SVG Spotlight Overlay -->
      <svg class="spotlight-overlay" id="spotlightSvg" viewBox="0 0 700 460" preserveAspectRatio="none">
        <defs>
          <mask id="spotMask">
            <rect width="100%" height="100%" fill="white" />
            <rect id="spotRect" x="0" y="0" width="0" height="0" rx="8" fill="black" />
          </mask>
        </defs>
        <rect width="100%" height="100%" fill="rgba(13,13,26,0.75)" mask="url(#spotMask)" />
      </svg>

    </div>

    <!-- Bubble Rail -->
    <div class="bubble-rail">
      <div class="bubble has-finding" data-index="0"></div>
      <div class="bubble has-finding" data-index="1"></div>
      <div class="bubble active" data-index="2"></div>
      <div class="bubble has-finding" data-index="3"></div>
      <div class="bubble" data-index="4"></div>
    </div>

  </div>

  <!-- CHIN — The Narrator -->
  <div class="chin" id="chin">

    <!-- Idle content (BROWSE mode) -->
    <div class="chin-idle">
      <span class="brand">SLAP!</span>
    </div>

    <!-- Spotlight content -->
    <div class="chin-spotlight" id="chinSpotlight">
      <div class="reviewer-avatar" id="spotAvatar">M</div>
      <div class="reviewer-info">
        <div class="reviewer-name" id="spotReviewerName">Marketing Expert</div>
        <div class="finding-text" id="spotFinding">Generic CTA with no urgency</div>
      </div>
      <div class="traffic-light red" id="spotTrafficLight"></div>
    </div>

    <!-- Tour content -->
    <div class="chin-tour" id="chinTour">
      <div class="tour-row1">
        <div class="tour-avatar" id="tourAvatar">M</div>
        <span class="tour-reviewer-name" id="tourReviewerName">Marketing Expert</span>
        <span class="tour-dash">&mdash;</span>
        <span class="tour-section-label" id="tourSectionLabel">HERO</span>
        <span class="tour-step-counter" id="tourStepCounter">[1/12]</span>
      </div>
      <div class="tour-row2">
        <div class="tour-finding" id="tourFinding">"Headline lacks specificity and emotional hook"</div>
      </div>
      <div class="tour-row3">
        <div class="progress-bar" id="progressBar">
          <span class="bar-filled"></span><span class="bar-empty"></span>
        </div>
        <div class="breadcrumb" id="breadcrumb">
          <span class="crumb active" data-section="0">HERO</span>
          <span class="crumb-sep">&gt;</span>
          <span class="crumb" data-section="1">FEAT</span>
          <span class="crumb-sep">&gt;</span>
          <span class="crumb" data-section="2">PRC</span>
          <span class="crumb-sep">&gt;</span>
          <span class="crumb" data-section="3">CTA</span>
        </div>
      </div>
    </div>

  </div>

</div>

<script>
// ── DATA ───────────────────────────────────────────────────
const SECTIONS = [
  {
    id: 'sec-0',
    label: 'HERO',
    crumb: 'HERO',
    reviewer: 'Marketing Expert',
    avatar: 'M',
    finding: 'Headline lacks specificity and emotional hook',
    findingQuoted: '"Headline lacks specificity and emotional hook"',
    light: 'yellow'
  },
  {
    id: 'sec-1',
    label: 'FEATURES',
    crumb: 'FEAT',
    reviewer: 'UX Designer',
    avatar: 'U',
    finding: 'Feature list feels generic \u2014 no differentiation from competitors',
    findingQuoted: '"Feature list feels generic \u2014 no differentiation from competitors"',
    light: 'yellow'
  },
  {
    id: 'sec-2',
    label: 'PRICING',
    crumb: 'PRC',
    reviewer: 'Marketing Expert',
    avatar: 'M',
    finding: 'No anchor pricing visible \u2014 users can\'t tell which tier is the best deal',
    findingQuoted: '"No anchor pricing visible \u2014 users can\'t tell which tier is the best deal."',
    light: 'red'
  },
  {
    id: 'sec-3',
    label: 'CTA',
    crumb: 'CTA',
    reviewer: 'Conversion Analyst',
    avatar: 'C',
    finding: 'Generic CTA with no urgency or value proposition',
    findingQuoted: '"Generic CTA with no urgency or value proposition"',
    light: 'red'
  }
];

// ── DOM REFS ───────────────────────────────────────────────
const frame = document.getElementById('frame');
const modeLabel = document.getElementById('modeLabel');
const tourBtn = document.getElementById('tourBtn');
const canvas = document.getElementById('canvas');
const spotlightSvg = document.getElementById('spotlightSvg');
const spotRect = document.getElementById('spotRect');

// Spotlight chin
const spotAvatar = document.getElementById('spotAvatar');
const spotReviewerName = document.getElementById('spotReviewerName');
const spotFinding = document.getElementById('spotFinding');
const spotTrafficLight = document.getElementById('spotTrafficLight');

// Tour chin
const tourAvatar = document.getElementById('tourAvatar');
const tourReviewerName = document.getElementById('tourReviewerName');
const tourSectionLabel = document.getElementById('tourSectionLabel');
const tourStepCounter = document.getElementById('tourStepCounter');
const tourFinding = document.getElementById('tourFinding');
const progressBar = document.getElementById('progressBar');
const breadcrumb = document.getElementById('breadcrumb');
const crumbs = breadcrumb.querySelectorAll('.crumb');

const sectionEls = SECTIONS.map(s => document.getElementById(s.id));
const bubbles = document.querySelectorAll('.bubble');

// ── HELPERS ────────────────────────────────────────────────
function setMode(mode) {
  frame.setAttribute('data-mode', mode);
  modeLabel.textContent = mode.toUpperCase();

  if (mode === 'tour') {
    tourBtn.classList.add('pulsing');
  } else {
    tourBtn.classList.remove('pulsing');
  }
}

function clearHovers() {
  sectionEls.forEach(el => el.classList.remove('hovered'));
}

function setHover(index) {
  clearHovers();
  if (index >= 0 && index < sectionEls.length) {
    sectionEls[index].classList.add('hovered');
  }
}

function showSpotlight(index) {
  const el = sectionEls[index];
  const canvasRect = canvas.getBoundingClientRect();
  const elRect = el.getBoundingClientRect();

  // Calculate positions relative to the canvas
  const svgW = canvas.offsetWidth;
  const svgH = canvas.offsetHeight;

  // Update SVG viewBox to match canvas dimensions
  spotlightSvg.setAttribute('viewBox', `0 0 ${svgW} ${svgH}`);

  const x = elRect.left - canvasRect.left;
  const y = elRect.top - canvasRect.top;
  const w = elRect.width;
  const h = elRect.height;

  spotRect.setAttribute('x', x - 4);
  spotRect.setAttribute('y', y - 4);
  spotRect.setAttribute('width', w + 8);
  spotRect.setAttribute('height', h + 8);

  spotlightSvg.classList.add('visible');
}

function hideSpotlight() {
  spotlightSvg.classList.remove('visible');
}

function updateSpotlightChin(index) {
  const sec = SECTIONS[index];
  spotAvatar.textContent = sec.avatar;
  spotReviewerName.textContent = sec.reviewer;
  spotFinding.textContent = sec.finding;
  spotTrafficLight.className = 'traffic-light ' + sec.light;
}

function updateTourChin(index, step, totalSteps) {
  const sec = SECTIONS[index];
  tourAvatar.textContent = sec.avatar;
  tourReviewerName.textContent = sec.reviewer;
  tourSectionLabel.textContent = sec.label;
  tourStepCounter.textContent = '[' + step + '/' + totalSteps + ']';
  tourFinding.textContent = sec.findingQuoted;

  // Update progress bar
  const totalBlocks = 14;
  const filled = Math.round((step / totalSteps) * totalBlocks);
  const empty = totalBlocks - filled;
  progressBar.querySelector('.bar-filled').textContent = '\u2588'.repeat(filled);
  progressBar.querySelector('.bar-empty').textContent = '\u2591'.repeat(empty);

  // Update breadcrumbs
  crumbs.forEach((crumb, i) => {
    crumb.classList.toggle('active', i === index);
  });

  // Update bubbles
  bubbles.forEach((b, i) => {
    b.classList.toggle('active', i === index);
    if (i !== index) {
      b.classList.add('has-finding');
    }
  });
}

// ── ANIMATION CYCLE ────────────────────────────────────────
// Timing:
//   0-3s:   Browse mode (chin 56px, "SLAP!")
//   3-7s:   Spotlight mode (chin 72px, single finding on section 2 PRICING)
//   7-20s:  Tour mode (chin 96px, spotlight moves through 4 sections)
//   Loop

const CYCLE_DURATION = 20000; // 20s total
const BROWSE_END = 3000;
const SPOTLIGHT_END = 7000;
const TOUR_END = 20000;
const TOUR_SECTIONS = 4;
const TOUR_SECTION_DURATION = (TOUR_END - SPOTLIGHT_END) / TOUR_SECTIONS; // 3250ms each

let animFrame;
let cycleStart;

function animationLoop(timestamp) {
  if (!cycleStart) cycleStart = timestamp;
  const elapsed = (timestamp - cycleStart) % CYCLE_DURATION;

  if (elapsed < BROWSE_END) {
    // ── BROWSE MODE ──
    if (frame.getAttribute('data-mode') !== 'browse') {
      setMode('browse');
      hideSpotlight();
      clearHovers();
    }
    // Simulate hover on section 1 during browse
    const browseProgress = elapsed / BROWSE_END;
    if (browseProgress > 0.2 && browseProgress < 0.5) {
      setHover(0);
    } else if (browseProgress > 0.5 && browseProgress < 0.8) {
      setHover(1);
    } else if (browseProgress > 0.8) {
      setHover(2);
    } else {
      clearHovers();
    }

  } else if (elapsed < SPOTLIGHT_END) {
    // ── SPOTLIGHT MODE ──
    if (frame.getAttribute('data-mode') !== 'spotlight') {
      setMode('spotlight');
      clearHovers();
      updateSpotlightChin(2); // PRICING section
    }
    showSpotlight(2);

  } else {
    // ── TOUR MODE ──
    if (frame.getAttribute('data-mode') !== 'tour') {
      setMode('tour');
      clearHovers();
    }
    const tourElapsed = elapsed - SPOTLIGHT_END;
    const sectionIndex = Math.min(
      Math.floor(tourElapsed / TOUR_SECTION_DURATION),
      TOUR_SECTIONS - 1
    );

    // Steps go: 1-3 per section, total 12 steps across 4 sections
    const stepsPerSection = 3;
    const totalSteps = TOUR_SECTIONS * stepsPerSection;
    const withinSection = (tourElapsed % TOUR_SECTION_DURATION) / TOUR_SECTION_DURATION;
    const subStep = Math.min(Math.floor(withinSection * stepsPerSection), stepsPerSection - 1);
    const currentStep = sectionIndex * stepsPerSection + subStep + 1;

    showSpotlight(sectionIndex);
    updateTourChin(sectionIndex, currentStep, totalSteps);
  }

  animFrame = requestAnimationFrame(animationLoop);
}

// Start the animation
requestAnimationFrame(animationLoop);
</script>

</body>
</html>
